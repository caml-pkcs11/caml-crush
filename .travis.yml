language: c

compiler: gcc

addons:
    apt:
        update: true
        packages:
            - autoconf
            - ocaml-nox
            - camlidl
            - coccinelle
            - libocamlnet-ocaml-dev
            - libocamlnet-ssl-ocaml
            - libocamlnet-ssl-ocaml-dev
            - libocamlnet-ocaml-bin
            - libconfig-file-ocaml-dev
            - camlp4
            - libssl-dev
            - gnutls-dev

script:
    - ./autogen.sh
    - ./configure --with-idlgen --with-rpcgen --with-libnames=foo --with-ssl --with-ssl-clientfiles='env'
    - make

jobs:
    include:
        - os: linux
          dist: trusty
          addons:   
            apt:
              update: true
              packages:
                  - autoconf
                  - ocaml-nox
                  - camlidl
                  - coccinelle
                  - libocamlnet-ocaml-dev
                  - libocamlnet-ssl-ocaml
                  - libocamlnet-ssl-ocaml-dev
                  - libocamlnet-ocaml-bin
                  - libconfig-file-ocaml-dev
                  - camlp4
                  - libssl-dev
                  - libgnutls-dev
                  - ca-certificates
                  - pkg-config
                  - rsync
                  - unzip
          before_script:
                - wget https://github.com/ocaml/opam/releases/download/2.0.7/opam-2.0.7-x86_64-linux -O /tmp/opam-2.0.7-x86_64-linux
                - sudo install /tmp/opam-2.0.7-x86_64-linux /usr/local/bin/opam
                - sudo opam init -a --disable-sandboxing && sudo opam update
                - sudo opam install ocamlfind -y
                - wget https://github.com/savonet/ocaml-ssl/releases/download/0.5.5/ocaml-ssl-0.5.5.tar.gz -O /tmp/ocaml-ssl-0.5.5.tar.gz
                - cd /tmp && tar xvzf /tmp/ocaml-ssl-0.5.5.tar.gz && cd ocaml-ssl-0.5.5 && ./configure && make && sudo make install
        - os: linux
          dist: xenial
        - os: linux
          dist: bionic
